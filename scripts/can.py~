import zmq
import sys

#stdout print function that works better with supervisord
def print_out ( str ):
	sys.stdout.write( str )
	sys.stdout.write( "\n" )
	sys.stdout.flush()

#init a CAN send socket
def init_sender():

	context = zmq.Context()

	sender = context.socket(zmq.PUSH)
	sender.connect("tcp://127.0.0.1:9998")

	return sender

#init a CAN receive socket
def init_receiver():

	context = zmq.Context()

	receiver = context.socket(zmq.SUB)
	receiver.connect("tcp://127.0.0.1:9999")
	
	return receiver

#non-blocking receive on a CAN socket
def recv_noblock(socket):

	try:
		can_message = receiver.recv(flags=zmq.NOBLOCK)
	except zmq.error.Again, e:
		can_message = "no_id no_message"
	return can_message

#add message filters to a CAN socket
def add_message_filters(socket, filters):

	for f in filters:
		socket.setsockopt(zmq.SUBSCRIBE, f)
	
#remove message filters from a CAN socket
def remove_message_filters(socket, filters):

	for f in filters:
		socket.setsockopt(zmq.UNSUBSCRIBE, f)
	
